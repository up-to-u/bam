<?include('inc/include.inc.php');echo template_header();$action = $_GET['action'];$edit_id = intval($_GET['edit_id']);$del_id = intval($_GET['del_id']);$update_id = intval($_POST['update_id']);$submit = $_POST['submit'];if ($submit=='save') {	$qx = true;		mysqli_autocommit($connect,FALSE);	for ($i=5; $i>=1; $i--) {		for ($j=1; $j<=5; $j++) {			$lv = intval($_POST['r_'.$i.'_'.$j]);						$sql = "UPDATE csa_risk_matrix SET csa_risk_level = $lv WHERE csa_impact_id = $i AND csa_likelihood_id = $j";			$q = mysqli_query($connect, $sql);			$qx = ($qx and $q);						}	}	if ($qx) {		mysqli_commit($connect);		echo "<font color='green'><b>ระบบได้บันทึกข้อมูลของท่านแล้ว</b></font><br><br>";		savelog('CSA-ADMIN-RISK-RISKMATRIX-UPDATE|');	} else {		mysqli_rollback($connect);		echo "<font color='red'><b>เกิดข้อผิดพลาด ระบบไม่สามารถบันทึกข้อมูลของท่านได้</b></font><br><br>";	}} 	$d = array();	$sql2="SELECT * FROM `csa_risk_matrix` ";	$result1=mysqli_query($connect, $sql2);	while ($row1 = mysqli_fetch_array($result1)) {		$d[$row1['csa_impact_id']][$row1['csa_likelihood_id']] = $row1['csa_risk_level']; 	}		$lv = array();	for ($i=1; $i<=5; $i++) {		$lv[] = risk_level_name($i);	}?><div class="row">	<div class="col-lg-12 col-xs-12 col-sm-12">		<div class="portlet light tasks-widget bordered">			<div class="portlet-title">				<div class="caption">					<i class="icon-grid font-green"></i>					<span class="caption-subject font-green sbold uppercase">ประเภทความเสี่ยง</span>					<span class="caption-helper"></span>				</div>				<div class="actions">				</div>			</div><br> <script language='JavaScript'>$(function () {	$('.csa_editable').on('click', function() {		var id = $(this).attr('did');		document.location="csa_admin_risk_type.php?edit_id="+id;	});		});  </script><style>.csa_editable {	cursor: pointer}</style><form method='post' action='csa_admin_risk_matrix.php'>   <table class='table table-bordered'><tr>  <td width='5%' rowspan='6'><br><br><br><br><br><br>Impact</td>  <td width='5%' colspan='5' align='center' style='text-align:center'>likelihood</td></tr><?	for ($i=5; $i>=1; $i--) {?><tr><?		for ($j=1; $j<=5; $j++) {			$l = $d[$i][$j];?>		<td width='5%' align='center' bgcolor='<?=risk_level_color($l)?>' id='rdiv_<?=$i?>_<?=$j?>'>	<select name='r_<?=$i?>_<?=$j?>' class='form-control'><? for ($k=1; $k<=4; $k++) {?><option value='<?=$k?>' <?if ($k==$l) echo 'selected'?>><?=risk_level_name($k)?></option><?}?>		</select>	</td><?		}?>	</tr><?	}	?></table>			                  	<br>	<button type="submit" name='submit' value='save' class="btn btn-danger"><i class='fa fa-save'></i> บันทึก</button>	</form>	</div></section>	<?echo template_footer();function risk_level_color($r) {	switch ($r) {		case 0: return '';		case 1: return '#9dff9c';		case 2: return '#f5ff9c';		case 3: return '#ffd29c';		case 4: return '#ff9c9c';	}}function risk_level_name($r) {	switch ($r) {		case 0: return '';		case 1: return 'ต่ำ';		case 2: return 'ปานกลาง';		case 3: return 'สูง';		case 4: return 'สูงมาก';	}}?>